---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const posts = (await getCollection('posts')).filter((post) => !post.data.draft);
const tagMap = new Map();

for (const post of posts) {
  for (const tag of post.data.tags ?? []) {
    tagMap.set(tag, (tagMap.get(tag) ?? 0) + 1);
  }
}

const tags = Array.from(tagMap.entries()).sort((a, b) => b[1] - a[1]);
const base = import.meta.env.BASE_URL;
---

<BaseLayout title="タグ一覧 | MyBlog" description="タグ別のメモ一覧">
  <section class="hero">
    <h1>タグ</h1>
    <p>よく使うテーマから素早く辿れるようにしています。</p>
  </section>

  <section class="grid two">
    {tags.map(([tag, count]) => (
      <a class="card" href={`${base}tags/${encodeURIComponent(tag)}/`}>
        <h3>{tag}</h3>
        <div class="meta">{count}件</div>
      </a>
    ))}
  </section>
</BaseLayout>
