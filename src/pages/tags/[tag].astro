---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  const tags = new Set();

  for (const post of posts) {
    if (post.data.draft) continue;
    for (const tag of post.data.tags ?? []) tags.add(tag);
  }

  return Array.from(tags).map((tag) => ({
    params: { tag: encodeURIComponent(tag) },
  }));
}

const tag = decodeURIComponent(Astro.params.tag);
const posts = (await getCollection('posts'))
  .filter((post) => !post.data.draft)
  .filter((post) => post.data.tags?.includes(tag));
---

<BaseLayout title={`タグ: ${tag} | MyBlog`} description={`${tag} のメモ一覧`}>
  <section class="hero">
    <h1>タグ: {tag}</h1>
    <p>該当するメモ一覧</p>
  </section>

  <section class="grid two">
    {posts.map((post) => (
      <PostCard post={post} />
    ))}
  </section>
</BaseLayout>
