---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const posts = (await getCollection('posts')).filter((post) => !post.data.draft);
const categoryMap = new Map();

for (const post of posts) {
  const category = post.data.category;
  categoryMap.set(category, (categoryMap.get(category) ?? 0) + 1);
}

const categories = Array.from(categoryMap.entries()).sort((a, b) => b[1] - a[1]);
const base = import.meta.env.BASE_URL;
---

<BaseLayout title="カテゴリ一覧 | MyBlog" description="カテゴリ別のメモ一覧">
  <section class="hero">
    <h1>カテゴリ</h1>
    <p>興味の領域ごとにまとめています。</p>
  </section>

  <section class="grid two">
    {categories.map(([category, count]) => (
      <a class="card" href={`${base}categories/${encodeURIComponent(category)}/`}>
        <h3>{category}</h3>
        <div class="meta">{count}件</div>
      </a>
    ))}
  </section>
</BaseLayout>
